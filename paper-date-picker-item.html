<link rel='import' href='../polymer/polymer.html'>
<link rel='import' href='../iron-icon/iron-icon.html'>
<link rel='import' href='../paper-item/paper-icon-item.html'>
<link rel='import' href='../paper-item/paper-item-body.html'>
<link rel='import' href='../paper-ripple/paper-ripple.html'>
<link rel='import' href='../paper-styles/paper-styles.html'>
<link rel='import' href='paper-date-picker-edit-dialog.html'>
<link rel='import' href='paper-date-picker-behaviors.html'>

<dom-module id='paper-date-picker-item'>

	<style>
		.icon {
			color: var(--disabled-text-color);
		}

		.item[has-no-date] .text {
			color: var(--secondary-text-color);
		}
	</style>

	<template>
		<paper-icon-item class='item' on-tap='_edit' has-no-date$=[[!date]]>
			<paper-ripple fit></paper-ripple>
			<iron-icon icon=[[icon]] item-icon class='icon'></iron-icon>
			<paper-item-body class='text'>[[_getFormattedDate(date)]]</paper-item-body>
		</paper-icon-item>
	</template>

</dom-module>

<script>

(function() {

	Polymer({
		is: 'paper-date-picker-item',
		behaviors: [DateFormatBehavior],
		properties: {
			date: {
				type: Date,
				value: null,
				notify: true
			},
			icon: String
		},

		// Private methods
		_edit: function() {
			var dialog = document.createElement('paper-date-picker-edit-dialog');

			// Wait until dialog is created before the properties can be set
			// @see http://stackoverflow.com/a/31482376
			this.async(function() {
				// Initialize dialog with the current date (default to today to avoid exception)
				dialog.date = this.date || new Date();

				// Capture date if the user saved the dialog
				dialog.addEventListener('paper-date-picker-edit-dialog-save', function(e) {
					this.date = e.detail;

					// Inform listener of "change" events when the date was changed
					this.fire('change', { value: this.date });
				}.bind(this));

				dialog.open();
			}.bind(this));

			// Return dialog for unit testing
			return dialog;
		}
	});

})();

</script>
